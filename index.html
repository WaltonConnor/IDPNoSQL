<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDP Front End</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="fullbox" id="TitleBox">Thor Database</div>
    <div class="fullbox" id="InformationBox">Please use the boxes below to select the table you wold like to search, as well as any details you would like to filter by.</div>
    
    <div class="fullbox" id="filtercontrols">
        <form>
            <!-- Initial selection for filtering data -->
            <label for="tablefilter">Choose a table to retrieve data from:</label>
            <select id="tablefilterbox" name="tablefilter" onchange="tableCheck()">
                <option selected disabled>Choose a selection:</option>
                <option id="patientselect" value="Patient">Patient</option>
                <option id="staffselect" value="Staff">Staff</option>
            </select>
            <br></br>
            <!-- Filter boxes for patient selection -->
            <label id="sexfilterlabel" for="sexfilter" style="display: none;">Choose a sex to filter the data: </label>
            <select id="sexfilterbox" name="sexfilter" style="display: none;" onchange="sexCheck()">
                <option selected disabled>Choose a sex:</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
            <br></br>
            <label id="allergyfilterlabel" for="allergyfilter" style="display: none;">Choose an allergy to filter the data: </label>
            <select id="allergyfilterbox" name="allergyfilter" style="display: none;" onchange="allergyCheck()">
                <option selected disabled>Choose an allergy:</option>
                <option value="Animals">Animals</option>
                <option value="Food">Food</option>
                <option value="Hay Fever">Hay Fever</option>
            </select>
            <br></br>
            <!-- Filter box for staff selection -->
            <label id="jobnamefilterlabel" for="jobnamefilterbox" style="display: none;">Choose the type of job to filter the data: </label>
            <select id="jobnamefilterbox" name="jobname filter" style="display: none;" onchange="jobnameCheck()">
                <option selected disabled>Choose a job:</option>
                <option value="Receptionist">Receptionist</option>
                <option value="Doctor">Doctor</option>
                <option value="Ambulance Team">Ambulance Team</option>
                <option value=" Facilities">Facilities</option>
                <option value="Management">Management</option>
                <option value="Nurse">Nurse</option>
                <option value="Pharmacy">Pharmacy</option>
                <option value="Phycological">Phycological</option>
                <option value="Midwife">Midwife</option>
                <option value="Support">Support</option>
            </select>
            <br></br>
            <label id="locationtypefilterlabel" for="locationtypefilter" style="display: none;">Choose the appointment location to filter the data: </label>
            <select id="locationtypefilterbox" name="locationtype filter" style="display: none;" onchange="locationtypeCheck()">
                <option selected disabled>Choose a location type:</option>
                <option value="Hospital">Hospital</option>
                <option value="Clinic">Clinic</option>
                <option value="Pharmacy">Pharmacy</option>
            </select>
            <br></br>
        </form>
    </div>

    <div>
        <button id="getPatients" onclick="searchPatients()" style="display: none;">Get</button>
        <button id="getStaff" onclick="searchStaff()" style="display: none;">Get</button>
    </div>
    
    <div class="grid-container" id=".grid-container"></div>
    
    <script>
        function tableCheck(){
            tableoutput = document.getElementById("tablefilterbox");
            var selectedText = tableoutput.options[tableoutput.selectedIndex].text;
            console.log(selectedText);
            switch (selectedText){
                case "Patient":
                    document.getElementById("jobnamefilterlabel").style.display="none";
                    document.getElementById("jobnamefilterbox").style.display="none";
                    document.getElementById("locationtypefilterlabel").style.display="none";
                    document.getElementById("locationtypefilterbox").style.display="none";
                    document.getElementById("getStaff").style.display="none";

                    document.getElementById("sexfilterlabel").style.display="block";
                    document.getElementById("sexfilterbox").style.display="block";
                    document.getElementById("allergyfilterlabel").style.display="block";
                    document.getElementById("allergyfilterbox").style.display="block";
                    document.getElementById("getPatients").style.display="block";
                    break;
                case "Staff":
                    document.getElementById("sexfilterlabel").style.display="none";
                    document.getElementById("sexfilterbox").style.display="none";
                    document.getElementById("allergyfilterlabel").style.display="none";
                    document.getElementById("allergyfilterbox").style.display="none";
                    document.getElementById("getPatients").style.display="none";

                    document.getElementById("jobnamefilterlabel").style.display="block";
                    document.getElementById("jobnamefilterbox").style.display="block";
                    document.getElementById("locationtypefilterlabel").style.display="block";
                    document.getElementById("locationtypefilterbox").style.display="block";
                    document.getElementById("getStaff").style.display="block";
                    break;
                default:
                    console.log("w-w-w whats goin on? *queue crazy frog*")
            }
        }
        function sexCheck(){
            tableoutput = document.getElementById("sexfilterbox");
            var selectedSex = tableoutput.options[tableoutput.selectedIndex].text;
            //console.log(selectedSex);
            return selectedSex;
        }
        function allergyCheck(){
            tableoutput = document.getElementById("allergyfilterbox");
            var selectedAllergy = tableoutput.options[tableoutput.selectedIndex].text;
            //console.log(selectedAllergy);
            return selectedAllergy;
        }
        function jobnameCheck(){
            tableoutput = document.getElementById("jobnamefilterbox");
            var jobname = tableoutput.options[tableoutput.selectedIndex].text;
            //console.log(jobname);
            return jobname;
        }
        function locationtypeCheck(){
            tableoutput = document.getElementById("locationtypefilterbox");
            var selectedlocationtype = tableoutput.options[tableoutput.selectedIndex].text;
            //console.log(selectedlocationtype);
            return selectedlocationtype;
        }

        async function searchPatients(){
            document.getElementById(".grid-container").innerHTML=""
            const type = sexCheck();
            const type2 = allergyCheck();
            console.log(type);
            console.log(type2);
            const query = `
            {
                patient(filter: { Sex: { eq: "`+type+`" }, and: { Allergies: { eq: "`+type2+`" } } }) {
                    items{
                        NHSnumber
                        FirstName
                        LastName
                        Sex
                        DoB
                        MobileNumber
                        HomeTelephone
                        Email
                        Address
                        City
                        Country
                        PostCode
                        Allergies
                        Notes
                        EmergencyContactName
                        EmergencyContactNumber
                        UpcomingAppointmentDate
                        PracticeName
                        AssignedMedicineName
                        AssignedMedicineManufacturer
                        id
                    }
                }
            }`;
            const endpoint = "/data-api/graphql";
            const response = await fetch(endpoint, { 
                method: "POST", 
                headers: { "Content-Type": "application/json" }, 
                body: JSON.stringify({ query: query }) 
            });
            const result = await response.json();
            //console.table(result.data.patient.items);
            valueLength = result.data.patient.items.length;
            valueLength += 1;
            for (let i = 1; i < valueLength; i++){
                const gridContainer = document.querySelector('.grid-container');
                const div = document.createElement('div');
                gridContainer.append(div);
        
                div.classList.add("item-container" + (i));
                div.id = 'icontainer';
            }
            valueLength2 = result.data.patient.items.length;
            for (let i2 = 0; i2 < valueLength2; i2++){
                item = result.data.patient.items[i2];
                console.log(item);
                var itemContainer = document.querySelector('.item-container' + (i2 += 1));
                nhs = item.NHSnumber;
                const line1 = document.createElement('l');
                itemContainer.append(line1);
                line1.innerText = "NHS Number = " + nhs;
                line1.id = 'pNHS';
                fname = item.FirstName;
                const line2 = document.createElement('l');
                itemContainer.append(line2);
                line2.innerText = "First Name = " + fname;
                line2.id = 'pFirstname';
                lname = item.LastName;
                const line3 = document.createElement('l');
                itemContainer.append(line3);
                line3.innerText = "Last Name = " + lname;
                line3.id = 'pLastname';
                sex = item.Sex;
                const line4 = document.createElement('l');
                itemContainer.append(line4);
                line4.innerText = "Sex = " + sex;
                line4.id = 'pSex';
                dob = item.DoB;
                const line5 = document.createElement('l');
                itemContainer.append(line5);
                line5.innerText = "Date of Birth = " + dob;
                line5.id = 'pDoB';
                mnumber = item.MobileNumber;
                const line6 = document.createElement('l');
                itemContainer.append(line6);
                line6.innerText = "Mobile Number = " + mnumber;
                line6.id = 'pMobileNumber';
                hnumber = item.HomeTelephone;
                const line7 = document.createElement('l');
                itemContainer.append(line7);
                line7.innerText = "Home Telephone = " + hnumber;
                line7.id = 'pHometelephone';
                email = item.Email;
                const line8 = document.createElement('l');
                itemContainer.append(line8);
                line8.innerText = "Email = " + email;
                line8.id = 'pEmail';
                address = item.Address;
                const line9 = document.createElement('l');
                itemContainer.append(line9);
                line9.innerText = "Address = " + address;
                line9.id = 'pAddress';
                city = item.City;
                const line10 = document.createElement('l');
                itemContainer.append(line10);
                line10.innerText = "City = " + city;
                line10.id = 'pCity';
                country = item.Country;
                const line11 = document.createElement('l');
                itemContainer.append(line11);
                line11.innerText = "Country = " + country;
                line11.id = 'pCountry';
                postcode = item.PostCode;
                const line12 = document.createElement('l');
                itemContainer.append(line12);
                line12.innerText = "Postcode = " + postcode;
                line12.id = 'pPostcode';
                allergies = item.Allergies;
                const line13 = document.createElement('l');
                itemContainer.append(line13);
                line13.innerText = "Allergies = " + allergies;
                line13.id = 'pAllergies';
                notes = item.Notes;
                const line14 = document.createElement('l');
                itemContainer.append(line14);
                line14.innerText = "Notes = " + notes;
                line14.id = 'pNotes';
                emergencycontname = item.EmergencyContactName;
                const line15 = document.createElement('l');
                itemContainer.append(line15);
                line15.innerText = "Emergency Contact Name = " + emergencycontname;
                line15.id = 'pEmergencycontactname';
                emergencycontnumber = item.EmergencyContactNumber;
                const line16 = document.createElement('l');
                itemContainer.append(line16);
                line16.innerText = "Emergency Contact Number = " + emergencycontnumber;
                line16.id = 'pEmergencycontactnumber';
                upcomingappdate = item.UpcomingAppointmentDate;
                const line17 = document.createElement('l');
                itemContainer.append(line17);
                line17.innerText = "Upcoming Appointment Date = " + upcomingappdate;
                line17.id = 'pUpcomingappointmentdate';
                practicename = item.PracticeName;
                const line18 = document.createElement('l');
                itemContainer.append(line18);
                line18.innerText = "Practice Name = " + practicename;
                line18.id = 'pPracticename';
                assignedmedicine = item.AssignedMedicineName;
                const line19 = document.createElement('l');
                itemContainer.append(line19);
                line19.innerText = "Assigned Medicine Name = " + assignedmedicine;
                line19.id = 'pAssignedmedicinename';
                assignedmedicinemanufacturer = item.AssignedMedicineManufacturer;
                const line20 = document.createElement('l');
                itemContainer.append(line20);
                line20.innerText = "Assigned Medicine Manufacturer = " + assignedmedicinemanufacturer;
                line20.id = 'pAssignedmedicinename';
                i2 -=1;
            }
        }
        async function searchStaff(){
            document.getElementById(".grid-container").innerHTML=""
            const type = jobnameCheck();
            const type2 = locationtypeCheck();
            console.log(type);
            console.log(type2);
            const query = `
            {
                staff(filter: { JobName: { eq: "`+type+`" }, and: { TypeOfPractice: { eq: "`+type2+`" } } }) {
                    items{
                        SID
                        FirstName
                        LastName
                        MobileNumber
                        HomeTelephone
                        Email
                        Address
                        City
                        Country
                        PostCode
                        EmergencyContactName
                        EmergencyContactNumber
                        JobName
                        JobSalery
                        JobHours
                        PracticeName
                        TypeOfPractice
                        PracticeAddress
                        PracticeCity
                        PracticeCountry
                        PracticePostcode
                        PracticeEmail
                        PracticePhoneNumber
                        id
                    }
                }
            }`;
            const endpoint = "/data-api/graphql";
            const response = await fetch(endpoint, { 
                method: "POST", 
                headers: { "Content-Type": "application/json" }, 
                body: JSON.stringify({ query: query }) 
            });
            const result = await response.json();
            //console.table(result.data.staff.items);
            valueLength = result.data.staff.items.length;
            valueLength += 1;
            for (let i = 1; i < valueLength; i++){
                const gridContainer = document.querySelector('.grid-container');
                const div = document.createElement('div');
                gridContainer.append(div);
        
                div.classList.add("item-container" + (i));
                div.id = 'icontainer';
            }
            valueLength2 = result.data.staff.items.length;
            for (let i2 = 0; i2 < valueLength2; i2++){
                item = result.data.staff.items[i2];
                console.log(item);
                var itemContainer = document.querySelector('.item-container' + (i2 += 1));
                sid = item.SID;
                const line1 = document.createElement('l');
                itemContainer.append(line1);
                line1.innerText = "SID = " + sid;
                line1.id = 'sSID';
                fname = item.FirstName;
                const line2 = document.createElement('l');
                itemContainer.append(line2);
                line2.innerText = "First Name = " + fname;
                line2.id = 'sFirstname';
                lname = item.LastName;
                const line3 = document.createElement('l');
                itemContainer.append(line3);
                line3.innerText = "Last Name = " + lname;
                line3.id = 'sLastname';
                mnumber = item.MobileNumber;
                const line4 = document.createElement('l');
                itemContainer.append(line4);
                line4.innerText = "Mobile Number = " + mnumber;
                line4.id = 'sMobileNumber';
                hnumber = item.HomeTelephone;
                const line5 = document.createElement('l');
                itemContainer.append(line5);
                line5.innerText = "Home Telephone = " + hnumber;
                line5.id = 'sHometelephone';
                email = item.Email;
                const line6 = document.createElement('l');
                itemContainer.append(line6);
                line6.innerText = "Email = " + email;
                line6.id = 'sEmail';
                address = item.Address;
                const line7 = document.createElement('l');
                itemContainer.append(line7);
                line7.innerText = "Address = " + address;
                line7.id = 'sAddress';
                city = item.City;
                const line8 = document.createElement('l');
                itemContainer.append(line8);
                line8.innerText = "City = " + city;
                line8.id = 'sCity';
                country = item.Country;
                const line9 = document.createElement('l');
                itemContainer.append(line9);
                line9.innerText = "Country = " + country;
                line9.id = 'sCountry';
                postcode = item.PostCode;
                const line10 = document.createElement('l');
                itemContainer.append(line10);
                line10.innerText = "Postcode = " + postcode;
                line10.id = 'sPostcode';
                emergencycontname = item.EmergencyContactName;
                const line11 = document.createElement('l');
                itemContainer.append(line11);
                line11.innerText = "Emergency Contact Name = " + emergencycontname;
                line11.id = 'sEmergencycontactname';
                emergencycontnumber = item.EmergencyContactNumber;
                const line12 = document.createElement('l');
                itemContainer.append(line12);
                line12.innerText = "Emergency Contact Number = " + emergencycontnumber;
                line12.id = 'sEmergencycontactnumber';
                jobname = item.JobName;
                const line13 = document.createElement('l');
                itemContainer.append(line13);
                line13.innerText = "Job Name = " + jobname;
                line13.id = 'sJobname';
                practicename = item.PracticeName;
                const line14 = document.createElement('l');
                itemContainer.append(line14);
                line14.innerText = "Practice Name = " + practicename;
                line14.id = 'sPracticename';
                typeofpractice = item.TypeOfPractice;
                const line15 = document.createElement('l');
                itemContainer.append(line15);
                line15.innerText = "Type Of Practice = " + typeofpractice;
                line15.id = 'sTypeofpractice';
                practiceaddress = item.PracticeAddress;
                const line16 = document.createElement('l');
                itemContainer.append(line16);
                line16.innerText = "Practice Address = " + practiceaddress;
                line16.id = 'sPracticeaddress';
                practicecity = item.PracticeCity;
                const line17 = document.createElement('l');
                itemContainer.append(line17);
                line17.innerText = "Practice City = " + practicecity;
                line17.id = 'sPracticecity';
                practicecountry = item.PracticeCountry;
                const line18 = document.createElement('l');
                itemContainer.append(line18);
                line18.innerText = "Practice Country = " + practicecountry;
                line18.id = 'sPracticecountry';
                practicepostcode = item.PracticePostcode;
                const line19 = document.createElement('l');
                itemContainer.append(line19);
                line19.innerText = "Practice Postcode = " + practicepostcode;
                line19.id = 'sPracticepostcode';
                practicepnumber = item.PracticePhoneNumber;
                const line20 = document.createElement('l');
                itemContainer.append(line20);
                line20.innerText = "Practice Phone Number = " + practicepnumber;
                line20.id = 'sPracticephonenumber';
                i2 -=1;
            }
        }
    </script>
</body>
</html>